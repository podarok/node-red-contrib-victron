<style>
  a.blue-link {
    color: rgb(71, 144, 208) !important;
  }
  .form-warning, .form-info {
        padding-bottom: 8px;
        max-width: 450px;
  }
  .form-warning .fa {
        color: #d6615f;
  }
</style>

<script type="text/javascript">
    function validateSwitchConfig() {
        const outputs = parseInt($('#node-input-switch_nrofoutput').val());
        const pwms = parseInt($('#node-input-switch_nrofpwm').val());

        if (outputs === 0 && pwms === 0) {
            $('#switch-validation-message').show();
        } else {
            $('#switch-validation-message').hide();
        }
    }

    function checkSelectedVirtualDevice() {
        [
            'battery', 'gps', 'grid', 'motordrive', 'pvinverter',
            'switch', 'tank', 'temperature'
        ].map( x => { $('.input-'+x).hide() })
        const selected = $('select#node-input-device').val()
        $('.input-'+selected).show()

        if (selected === 'temperature') {
            // Show/hide battery voltage input based on checkbox
            $('#node-input-include-battery').off('change').on('change', function() {
                if($(this).is(':checked')) {
                    $('#battery-voltage-row').show()
                } else {
                    $('#battery-voltage-row').hide()
                }
            })

            // Initially set battery voltage visibility
            $('#battery-voltage-row').toggle($('#node-input-include-battery').is(':checked'))
        }

        if (selected === 'gps') {
            $('#node-input-default_values').prop('checked', false).prop('disabled', true)
        } else {
            $('#node-input-default_values').prop('disabled', false)
        }

        if (selected === 'switch') {
            validateSwitchConfig();
            $('#node-input-switch_nrofoutput, #node-input-switch_nrofpwm').off('change').on('change', function() {
                validateSwitchConfig();
                updateSwitchInitialStateOptions();
            });
            updateSwitchInitialStateOptions();
        }
    }

    function updateSwitchInitialStateOptions() {
        // Show/hide initial state options based on number of outputs and PWMs
        const outputs = parseInt($('#node-input-switch_nrofoutput').val());
        const pwms = parseInt($('#node-input-switch_nrofpwm').val());

        $('.switch-initial-state-container').empty();

        for (let i = 1; i <= outputs; i++) {
            const switchTypeDiv = $('<div class="form-row switch-type-row"></div>');
            switchTypeDiv.append(`<label for="node-input-switch_output_${i}_type">Switch ${i} Type</label>`);

            const typeSelect = $(`<select id="node-input-switch_output_${i}_type" data-output-index="${i}" data-output-type="output">`);
            typeSelect.append('<option value="1">Latching (On/Off)</option>');
            typeSelect.append('<option value="0">Momentary (Pulse)</option>');

            switchTypeDiv.append(typeSelect);
            $('.switch-initial-state-container').append(switchTypeDiv);

            const outputDiv = $('<div class="form-row switch-initial-state-row"></div>');
            outputDiv.append(`<label for="node-input-switch_output_${i}_initial_state">Switch ${i} Initial State</label>`);

            const select = $(`<select id="node-input-switch_output_${i}_initial_state" data-output-index="${i}" data-output-type="output">`);
            select.append('<option value="previous">Previous (from memory)</option>');
            select.append('<option value="off">Off</option>');
            select.append('<option value="on">On</option>');
            select.append('<option value="null">Don\'t set (null)</option>');
            
            outputDiv.append(select);
            $('.switch-initial-state-container').append(outputDiv);
        }

        for (let i = 1; i <= pwms; i++) {
            const pwmDiv = $('<div class="form-row switch-initial-state-row"></div>');
            pwmDiv.append(`<label for="node-input-switch_pwm_${i}_initial_state">Slider ${i}</label>`);
            
            const select = $(`<select id="node-input-switch_pwm_${i}_initial_state" data-output-index="${i}" data-output-type="pwm">`);
            select.append('<option value="previous">Previous (from memory)</option>');
            select.append('<option value="off">Off (0%)</option>');
            select.append('<option value="custom">Custom Value</option>');
            select.append('<option value="null">Don\'t set (null)</option>');
            
            pwmDiv.append(select);

            const customValueDiv = $(`<div class="form-row switch-pwm-custom-value" id="node-input-switch_pwm_${i}_custom_value_container" style="display:none;">`);
            customValueDiv.append(`<label></label><label for="node-input-switch_pwm_${i}_custom_value" style="width:auto;">Initial Value (%):</label>`);
            customValueDiv.append(`<input type="number" id="node-input-switch_pwm_${i}_custom_value" style="width:100px;" min="0" max="100" step="1" value="50">`);

            $('.switch-initial-state-container').append(pwmDiv);
            $('.switch-initial-state-container').append(customValueDiv);

            select.change(function() {
                const showCustom = $(this).val() === 'custom';
                $(`#node-input-switch_pwm_${i}_custom_value_container`).toggle(showCustom);
            });
        }
    }

    RED.nodes.registerType('victron-virtual',{
        category: 'Victron Energy',
        color: '#f7ab3e',
        paletteLabel: "Virtual Device",
        defaults: {
            name: {value:""},
            device: {value:"", required: true},
            default_values: {value: false, required: false},
            // battery
            battery_capacity: {value: 25, required: false},
            include_battery_temperature: {value: false},
            // grid
            grid_nrofphases: {value: 1, required: false},
            // motordrive
            include_motor_temp: {value: false},
            include_controller_temp: {value: false},
            include_coolant_temp: {value: false},
            include_motor_rpm: {value: true},
            include_motor_direction: {value: true},
            // pvinverter
            position: { value: 0, required: false},
            pvinverter_nrofphases: {value: 1, required: false},
            // switch
            switch_nrofoutput: {value: 1, required: false,
                validate: function(v) {
                    if (this.device !== 'switch') return true;

                    const outputs = parseInt(v);
                    const pwms = parseInt(this.switch_nrofpwm);

                    return (outputs > 0 || pwms > 0);
                }
            },
            switch_output_types: {value: {}, required: false},
            switch_nrofpwm: {value: 1, required: false,
                validate: function(v) {
                    if (this.device !== 'switch') return true;

                    const pwms = parseInt(v);
                    const outputs = parseInt(this.switch_nrofoutput);

                    return (outputs > 0 || pwms > 0);
                }
            },
            switch_output_initial_states: {value: {}, required: false},
            switch_pwm_initial_states: {value: {}, required: false},
            // tank
            fluid_type: { value: 0, required: false},
            include_tank_battery: { value: false },
            include_tank_temperature: {value: false},
            tank_battery_voltage: { value: 3.3 },
            tank_capacity: {value:0.2, required:false,
                validate: v => {
                    if (v === '' || v === undefined) return true;
                    const num = Number(v);
                    return !isNaN(num) && num > 0;
                }
            },
            // temperature
            temperature_type: {value: 2, required: false},
            include_humidity: { value: false },
            include_pressure: { value: false },
            include_temp_battery: { value: false },
            temp_battery_voltage: { value: 3.3 }
        },
        icon: "victronenergy.svg",
        inputs:0,
        outputs:0,
        label: function() {
            return (this.name||"Virtual "+this.device)
        },
        oneditprepare: function oneditprepare() {
            checkSelectedVirtualDevice()
            if (this.device === 'switch') {
                setTimeout(() => {
                    if (this.switch_output_types) {
                        for (const [index, type] of Object.entries(this.switch_output_types)) {
                            $('#node-input-switch_output_' + index + '_type').val(type);
                        }
                    }

                    if (this.switch_output_initial_states) {
                        for (const [index, state] of Object.entries(this.switch_output_initial_states)) {
                            $('#node-input-switch_output_' + index + '_initial_state').val(state);
                        }
                    }

                    if (this.switch_pwm_initial_states) {
                        for (const [index, stateObj] of Object.entries(this.switch_pwm_initial_states)) {
                            $('#node-input-switch_pwm_' + index + '_initial_state').val(stateObj.type);
                            if (stateObj.type === 'custom') {
                                $('#node-input-switch_pwm_' + index + '_custom_value').val(stateObj.value);
                                $('#node-input-switch_pwm_' + index + '_custom_value_container').show();
                            }
                        }
                    }
                }, 100);
            }
        },
        oneditsave: function oneditsave() {
            if (this.device === 'switch') {
                const outputs = parseInt($('#node-input-switch_nrofoutput').val());
                const pwms = parseInt($('#node-input-switch_nrofpwm').val());

                if (outputs === 0 && pwms === 0) {
                    return false;
                }

                const outputTypes = {};
                for (let i = 1; i <= outputs; i++) {
                    outputTypes[i] = $('#node-input-switch_output_' + i + '_type').val();
                }
                this.switch_output_types = outputTypes;

                const outputStates = {};
                for (let i = 1; i <= outputs; i++) {
                    outputStates[i] = $('#node-input-switch_output_' + i + '_initial_state').val();
                }
                this.switch_output_initial_states = outputStates;

                const pwmStates = {};
                for (let i = 1; i <= pwms; i++) {
                    const stateType = $('#node-input-switch_pwm_' + i + '_initial_state').val();
                    pwmStates[i] = {
                        type: stateType,
                        value: stateType === 'custom' ? 
                            parseFloat($('#node-input-switch_pwm_' + i + '_custom_value').val()) : 0
                    };
                }
                this.switch_pwm_initial_states = pwmStates;
            }
            return true;
        }
    });
</script>

<script type="text/html" data-template-name="victron-virtual">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <input type="hidden" id="node-input-instance">
    <div class="form-row">
        <label for="node-input-device"><i class="fa fa-microchip"></i> Device</label>
        <select id="node-input-device" required onchange="checkSelectedVirtualDevice()">
            <option value="battery">Battery</option>
            <option value="gps">GPS</option>
            <option value="grid">Grid meter</option>
            <option value="meteo">Meteo</option>
            <option value="motordrive">Motor drive</option>
            <option value="pvinverter">PV inverter</option>
            <option value="switch">Switch</option>
            <option value="tank">Tank sensor</option>
            <option value="temperature">Temperature sensor</option>
        </select>
    </div>
    <div class="input-battery">
        <div class="form-row" id="battery-capacity">
            <label for="node-input-battery_capacity"><i class="fa fa-flask"></i> Battery Capacity (Ah)</label>
            <input type="number" id="node-input-battery_capacity" min="0">
        </div>

        <div class="form-row">
            <label>&nbsp;</label>
            <label for="node-input-include_battery_temperature" style="width:70%;">
                <input type="checkbox" id="node-input-include_battery_temperature" style="display:inline-block; width:22px; vertical-align:baseline;">
                Include battery temperature
            </label>
        </div>

        <div class="form-row">
            <label>&nbsp;</label>
            <div class="form-tips" style="display: block;">
                <p><strong>Note:</strong> The battery will include most standard alarm and error fields required for proper integration with VRM and GX devices.</p>
            </div>
        </div>
    </div>
    <div class="input-grid">
        <div class="form-tips" style="display: block;">
            <p><strong>Note:</strong> Do not use this feature to make an ESS system with third party energy meters. There are multiple <a href="https://www.victronenergy.com/meters-and-sensors/energy-meter" class="blue-link">officially supported meters</a> that can be used in a Victron ESS system. Using other meters has proven too often to lead to issues related with stability.</p>
        </div>
        <div class="form-row">
            <label for="node-input-grid_nrofphases"><i class="fa fa-plug"></i> Nr of phases</label>
            <select id="node-input-grid_nrofphases">
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
            </select>
        </div>
    </div>
    <div class="input-tank">
        <div class="form-row">
            <label for="node-input-fluid_type"><i class="fa fa-tint"></i> Fluid type</label>
            <select id="node-input-fluid_type">
                <option value="0">Fuel</option>
                <option value="1">Fresh water</option>
                <option value="2">Waste water</option>
                <option value="3">Live well</option>
                <option value="4">Oil</option>
                <option value="5">Black water (sewage)</option>
                <option value="6">Gasoline</option>
                <option value="7">Diesel</option>
                <option value="8">LPG</option>
                <option value="9">LNG</option>
                <option value="10">Hydraulic oil</option>
                <option value="11">Raw water</option>
            </select>
        </div>

        <div class="form-row" id="tank-capacity">
            <label for="node-input-tank_capacity"><i class="fa fa-flask"></i> Tank Capacity (m<sup>3</sup>)</label>
            <input type="text" id="node-input-tank_capacity"
            pattern="^(?:[0-9]+(?:\.[0-9]{0,3})?|\.[0-9]{1,3})$"
            value="0.2"
            title="Enter a positive number with up to 3 decimal places">
        </div>
        <div class="form-row">
            <label>&nbsp;</label>
            <label for="node-input-include_tank_temperature" style="width:70%;">
                <input type="checkbox" id="node-input-include_tank_temperature" style="display:inline-block; width:22px; vertical-align:baseline;">
                Include temperature
            </label>
        </div>

        <div class="form-row">
            <label>&nbsp;</label>
            <label for="node-input-include_tank_battery" style="width:70%;">
                <input type="checkbox" id="node-input-include_tank_battery" style="display:inline-block; width:22px; vertical-align:baseline;">
                Include Battery Voltage
            </label>
        </div>

        <div class="form-row" id="tank_battery-voltage-row">
            <label>&nbsp;</label>
            <label for="node-input-tank_battery_voltage" style="width:auto;">Battery Voltage (V):</label>
            <input type="number" id="node-input-tank_battery_voltage" style="width:100px;" value="3.3" step="0.1" min="0">
        </div>
    </div>

    <div class="input-motordrive">
        <div class="form-row">
            <label>&nbsp;</label>
            <label for="node-input-include_motor_rpm" style="width:70%;">
                <input type="checkbox" id="node-input-include_motor_rpm" style="display:inline-block; width:22px; vertical-align:baseline;" checked>
                Include motor RPM
            </label>
        </div>
        <div class="form-row">
            <label>&nbsp;</label>
            <label for="node-input-include_motor_direction" style="width:70%;">
                <input type="checkbox" id="node-input-include_motor_direction" style="display:inline-block; width:22px; vertical-align:baseline;" checked>
                Include motor direction
            </label>
        </div>
        <div class="form-row">
            <label>&nbsp;</label>
            <label for="node-input-include_motor_temp" style="width:70%;">
                <input type="checkbox" id="node-input-include_motor_temp" style="display:inline-block; width:22px; vertical-align:baseline;">
                Include motor temperature
            </label>
        </div>
        <div class="form-row">
            <label>&nbsp;</label>
            <label for="node-input-include_controller_temp" style="width:70%;">
                <input type="checkbox" id="node-input-include_controller_temp" style="display:inline-block; width:22px; vertical-align:baseline;">
                Include controller temperature
            </label>
        </div>
        <div class="form-row">
            <label>&nbsp;</label>
            <label for="node-input-include_coolant_temp" style="width:70%;">
                <input type="checkbox" id="node-input-include_coolant_temp" style="display:inline-block; width:22px; vertical-align:baseline;">
                Include coolant temperature
            </label>
        </div>
    </div>

    <div class="input-pvinverter">
        <div class="form-row">
            <label for="node-input-position"><i class="fa fa-sliders"></i> Position</label>
            <select id="node-input-position">
                <option value="0">AC input 1</option>
                <option value="1">AC output</option>
                <option value="2">AC input 2</option>
            </select>
        </div>
        <div class="form-row">
            <label for="node-input-pvinverter_nrofphases"><i class="fa fa-plug"></i> Nr of phases</label>
            <select id="node-input-pvinverter_nrofphases">
                <option value="1">1</option>
                <option value="3">3</option>
            </select>
        </div>
    </div>

    <div class="input-switch">
        <div class="form-row">
            <label for="node-input-switch_nrofoutput"><i class="fa fa-plug"></i> Nr of switches</label>
            <select id="node-input-switch_nrofoutput">
                <option value="0">0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
            </select>
        </div>
        <div class="form-row">
            <label for="node-input-switch_nrofpwm"><i class="fa fa-plug"></i> Nr of sliders</label>
            <select id="node-input-switch_nrofpwm">
                <option value="0">0</option>
                <option value="1">1</option>
                <option value="2">2</option>
                <option value="3">3</option>
            </select>
        </div>
        <div class="form-warning" id="switch-validation-message" style="display:none;">
            <i class="fa fa-exclamation-triangle"></i> At least one of latching switches or dimmable switches must be greater than zero.
        </div>

        <div class="form-row" id="switch-initial-states-header" style="margin-top: 10px;">
            <label><i class="fa fa-sliders"></i> Initial States</label>
        </div>
        <div class="switch-initial-state-container">
            <!-- This will be populated dynamically -->
        </div>
    </div>

    <div class="input-temperature">
        <div class="form-row">
            <label for="node-input-temperature_type"><i class="fa fa-thermometer-half"></i> Temperature type</label>
            <select id="node-input-temperature_type">
                <option value="0">Battery</option>
                <option value="1">Fridge</option>
                <option value="2">Generic</option>
                <option value="3">Room</option>
                <option value="4">Outdoor</option>
                <option value="5">WaterHeater</option>
                <option value="6">Freezer</option>
            </select>
        </div>

        <div class="form-row">
            <label>&nbsp;</label>
            <label for="node-input-include_humidity" style="width:70%;">
                <input type="checkbox" id="node-input-include_humidity" style="display:inline-block; width:22px; vertical-align:baseline;">
                Include Humidity Sensor
            </label>
        </div>

        <div class="form-row">
            <label>&nbsp;</label>
            <label for="node-input-include_pressure" style="width:70%;">
                <input type="checkbox" id="node-input-include_pressure" style="display:inline-block; width:22px; vertical-align:baseline;">
                Include Pressure Sensor
            </label>
        </div>

        <div class="form-row">
            <label>&nbsp;</label>
            <label for="node-input-include_temp_battery" style="width:70%;">
                <input type="checkbox" id="node-input-include_temp_battery" style="display:inline-block; width:22px; vertical-align:baseline;">
                Include Battery Voltage
            </label>
        </div>

        <div class="form-row" id="battery-temp_voltage-row">
            <label>&nbsp;</label>
            <label for="node-input-temp_battery_voltage" style="width:auto;">Battery Voltage (V):</label>
            <input type="number" id="node-input-temp_battery_voltage" style="width:100px;" value="3.3" step="0.1" min="0">
        </div>
    </div>
    <div class="form-row">
        <label>&nbsp;</label>
        <div style="width:70%">
            <label for="node-input-default_values" style="width:100%">
                <input type="checkbox" id="node-input-default_values" style="display:inline-block; width:22px; vertical-align:baseline;">
                Initialize with default values
            </label>
            <div class="form-tips" style="margin-top:3px;">
                Use this to make the device appear on VRM and/or GUI-v2 immediately after deploying.<br />This is done by setting default values, which you can change later.
            </div>
        </div>
    </div>
</script>

<script type="text/markdown" data-help-name="victron-virtual">

The _Virtual Device_ node creates a virtual device on the underlying `dbus`, which allows for reading from and writing to the device as
if it is an actually connected device. The virtual device will also show up in VRM, allowing you to plot data from less-supported hardware.

Important note: Please be aware that using virtual devices on Victron systems may result in lower performance compared to using actual physical devices. Additionally, there is no official support provided when using virtual devices. These tools are intended for advanced users who understand and accept these limitations.

## Adding a device

To get started, pull a virtual device to the canvas and configure it. First the
device type needs to be selected. At the moment the system supports:
- Battery
- Grid meter
- Meteo
- Motor drive
- PV inverter
- Switch
- Tank sensor
- Temperature sensor

Depending on the selected device type, you may get a few more fields that need
to be filled out. They are described below for each type of device.

Once the device has been deployed and the flow restarted, the device should
appear on the dbus. Then you can use a custom output node to write values to
the device. And of course use the regular nodes to read from the device.

Note that the _deviceInstance_, which uniquely defines a device on the dbus
will be generated automatically. The node status will show the obtained
deviceInstance in brackets. The label of the node will be set as _CustomName_
for the device, making it all easier to identify the virtual device.

Also note that it might take a short while before the service on the dbus is
actually created. So best practice is to wait a second before injecting data
into the virtual device.

With most virtual devices, you can pre-define some values via the edit panel to
make its use more convenient. For other devices, the edit panel allows you to
enable or disable some of the paths.

Depending on the created device, it might not appear on VRM directly. You will
need to write some values to it first. Alternative, you could use _initialize
with defaults_ to make it appear on VRM directly. Do note that those default
values probably are not the one that make a lot of sense for your specific
situation. But it can help to get you started.

### Battery

The battery device allows for setting the capacity of the battery. The capacity
is configured in Ah.

Including the battery temperature adds a field to write the temperature to.

### GPS

The GPS device does not have any specific configuration options. It is used to
send GPS data to VRM, typically used in a marine envirionment or on a camper van.
On the VRM side, the GPS data will be used to determine the location of GX
device, which is also used for forecasting solar yield. It won't show up on
the device list, but can be found under the GPS menu in settings in the GUI.

Setting the _initialize with default values_ is disabled for virtual GPS devices,
as that could put your GX device unintentionally in the middle of the ocean
and mess up solar forecast.

### Grid meter

For the grid meter, you wil need to select the number of phases that are
available on the device.

Do not use this feature to make an ESS system with third party energy meters.
There are multiple [officially supported
meters](https://www.victronenergy.com/meters-and-sensors/energy-meter) that can
be used in a Victron ESS system. Using other meters has proven too often to
lead to issues related with stability.

### Meteo

The meteo device only supports the irradiance and windspeed. Typically you
would use it to send data from your weather stations to both a virtual meteo
device and a virtual temperature sensor.

### Motor drive

The motor drive device represents an electric drive system, which can be used for various electric propulsion applications such as boats or electric vehicles.

The basic parameters for a motor drive are voltage, current, and power, which function similar to a battery device. The motor drive can have both positive and negative values for current and power, depending on whether the motor is consuming power or regenerating (when braking or going downhill).

Additionally, you can enable optional monitoring parameters:
- Motor RPM
- Motor direction (Neutral, Reverse, Forward)
- Motor temperature
- Controller temperature
- Coolant temperature

These additional parameters can help monitor the performance and status of your electric drive system.

### PV inverter

For the PV inverter you can set the position of the inverter. This can be:
- AC input 1
- AC output
- AC input 2

You can also set the number of phases that are available on the device. Do
note that changing this number while the device has been deployed is will not
result in the extra phases being created. They are only created during deployment.

### Switch

For the switch you can set the number of latching switches and the number of dimmable
switches (PWM). The latching switches can be configured in two different modes:

1. **Latching (On/Off)** - Stays in the state it's set to (on or off) until changed
2. **Momentary (Pulse)** - Provides a momentary pulse, then returns to its default state

The number of dimmable switches determines how many sliders are available for dimming control.

This follows the same logic as the actual GX IO-Extender 150. You can set
the port as a momentary switch, latching switch or as a dimmable output (PWM).

Each switch or slider can be configured with different initial states:

1. **Previous (from memory)** - Restores the last state from memory when Node-RED restarts
2. **Off** - Sets the switch to off (0) or the slider to 0% when deployed
3. **On** - Sets the switch to on (1) when deployed (switches only)
4. **Custom Value** - Sets the slider to a custom percentage value (sliders only)
5. **Don't set (null)** - Doesn't change the state at all on deployment, requiring manual control

The "Don't set (null)" option is useful when you want to:
- Avoid any automatic state changes during deployment
- Manually control the state after deployment
- Keep the current state without modifying it on restart
- Implement custom initialization logic in your flows

You can use the switch nodes to read from and control the virtual switch.

Note that writing a `1` to the `Settings/${switch/slider}/Settings/ShowUIControl` path can make the switch or slider visible in the GUI,
allowing it to be only visible on request. By default the switch is set to be visible.

### Tank sensor

For the tank sensor you can pre-define some values, like the liquid type and
the capacity.  The capacity is a number. The volume unit is something that is
defined on the GX.

### Temperature sensor

Next to setting the temperature, the temperature sensor allows for setting
humidity, pressure and battery voltage.


## Device Visibility

Depending on the created device, it might not appear immediately on the GX device or VRM portal. You will need to write some values to it first. Alternatively, you could use _Initialize with default values_ to make it appear on the GX device directly. Please note that those default values may not be appropriate for your specific situation, but it can help to get you started.

Important notes about visibility:
- Most virtual devices will appear on both the GX device GUI and the VRM portal once they have values
- Virtual switch devices will ONLY be visible on the GX device GUI (GUI-v2) and will NOT appear on the VRM portal
- Virtual GPS devices will not show up on the device list, but can be found under the GPS menu in settings in the GUI

Also note that it might take a short while before the service on the dbus is actually created. So best practice is to wait a second before injecting data into the virtual device.

</script>
